<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude LangGraph å¤š Agent åä½œç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- å¤´éƒ¨ -->
        <header class="header">
            <h1>ğŸ¤– Claude LangGraph å¤š Agent åä½œç³»ç»Ÿ</h1>
            <div class="connection-status" :class="{ connected: wsConnected }">
                {{ wsConnected ? 'ğŸŸ¢ å·²è¿æ¥' : 'ğŸ”´ æ–­å¼€' }}
            </div>
        </header>

        <main class="main-container">
            <!-- å·¦ä¾§ï¼šä»»åŠ¡åˆ—è¡¨ -->
            <aside class="sidebar">
                <div class="panel">
                    <h2>ğŸ“‹ ä»»åŠ¡åˆ—è¡¨</h2>
                    <button class="btn btn-primary" @click="showNewTask = true">
                        + æ–°å»ºä»»åŠ¡
                    </button>
                    <div class="task-list">
                        <div
                            v-for="task in tasks"
                            :key="task.id"
                            class="task-item"
                            :class="{ active: selectedTask?.id === task.id }"
                            @click="selectTask(task)"
                        >
                            <div class="task-header">
                                <span class="task-status" :class="task.status">
                                    {{ getStatusIcon(task.status) }}
                                </span>
                                <span class="task-title">{{ task.task.slice(0, 30) }}...</span>
                            </div>
                            <div class="task-meta">
                                <span>{{ task.subtasks?.length || 0 }} å­ä»»åŠ¡</span>
                                <span>{{ task.time_minutes || 'âˆ' }} åˆ†é’Ÿ</span>
                            </div>
                        </div>
                        <div v-if="tasks.length === 0" class="empty-state">
                            æš‚æ— ä»»åŠ¡ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»º
                        </div>
                    </div>
                </div>
            </aside>

            <!-- ä¸­é—´ï¼šGraph å¯è§†åŒ– -->
            <section class="content">
                <div class="panel">
                    <h2>ğŸ”„ Graph å¯è§†åŒ–</h2>
                    <div class="graph-container" v-html="mermaidSvg"></div>
                </div>

                <!-- å­ä»»åŠ¡è¿›åº¦ -->
                <div class="panel" v-if="selectedTask">
                    <h2>ğŸ“Š ä»»åŠ¡è¿›åº¦</h2>
                    <div class="subtask-list">
                        <div
                            v-for="subtask in selectedTask.subtasks"
                            :key="subtask.id"
                            class="subtask-item"
                            :class="subtask.status"
                            @click="selectSubtask(subtask)"
                        >
                            <span class="subtask-status">{{ getStatusIcon(subtask.status) }}</span>
                            <span class="subtask-title">{{ subtask.title }}</span>
                            <span class="subtask-agent">{{ subtask.agent_type }}</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- å³ä¾§ï¼šè®¨è®ºåº“ -->
            <aside class="sidebar right">
                <div class="panel" v-if="selectedSubtask">
                    <h2>ğŸ’¬ è®¨è®º - {{ selectedSubtask.title }}</h2>
                    <div class="discussion-container">
                        <div
                            v-for="msg in discussionMessages"
                            :key="msg.id"
                            class="message"
                            :class="msg.message_type"
                        >
                            <div class="message-header">
                                <span class="from-agent">{{ msg.from_agent }}</span>
                                <span class="timestamp">{{ formatTime(msg.timestamp) }}</span>
                            </div>
                            <div class="message-content">{{ msg.content }}</div>
                        </div>
                        <div v-if="discussionMessages.length === 0" class="empty-state">
                            æš‚æ— è®¨è®º
                        </div>
                    </div>
                    <div class="message-input">
                        <select v-model="newMessage.from_agent">
                            <option value="director">Director</option>
                            <option value="coder">Coder</option>
                            <option value="researcher">Researcher</option>
                            <option value="writer">Writer</option>
                            <option value="analyst">Analyst</option>
                        </select>
                        <input
                            v-model="newMessage.content"
                            @keyup.enter="sendMessage"
                            placeholder="è¾“å…¥æ¶ˆæ¯..."
                        >
                        <button class="btn btn-primary" @click="sendMessage">å‘é€</button>
                    </div>
                </div>
                <div class="panel" v-else>
                    <h2>ğŸ’¬ è®¨è®º</h2>
                    <div class="empty-state">
                        é€‰æ‹©ä¸€ä¸ªå­ä»»åŠ¡æŸ¥çœ‹è®¨è®º
                    </div>
                </div>
            </aside>
        </main>

        <!-- æ–°å»ºä»»åŠ¡å¼¹çª— -->
        <div class="modal" v-if="showNewTask" @click.self="showNewTask = false">
            <div class="modal-content">
                <h2>ğŸ“ æ–°å»ºä»»åŠ¡</h2>
                <div class="form-group">
                    <label>ä»»åŠ¡æè¿°</label>
                    <textarea v-model="newTask.task" placeholder="æè¿°ä½ è¦å®Œæˆçš„ä»»åŠ¡..."></textarea>
                </div>
                <div class="form-group">
                    <label>æ—¶é—´é¢„ç®—ï¼ˆåˆ†é’Ÿï¼‰</label>
                    <input type="number" v-model="newTask.time_minutes" placeholder="ç•™ç©ºè¡¨ç¤ºæ— é™åˆ¶">
                </div>
                <div class="form-actions">
                    <button class="btn" @click="showNewTask = false">å–æ¶ˆ</button>
                    <button class="btn btn-primary" @click="createTask">åˆ›å»º</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
